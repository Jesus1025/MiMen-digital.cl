{% extends "base.html" %}

{% block title %}Detalle Factura - TekneTau{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <h3>Factura <small class="text-muted">#{{ factura.numero_doc }} ({{ factura.tipo_doc }})</small></h3>
                <div class="text-muted">Estado: <strong>{{ factura.estado }}</strong></div>
            </div>
            <div class="text-end">
                <a href="/facturas" class="btn btn-secondary btn-sm">← Volver</a>
                <button class="btn btn-primary btn-sm" onclick="window.print()">Imprimir</button>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <h5>Emisor</h5>
                <p>TEKNETAU SPA</p>
                <p><small class="text-muted">Usuario: {{ factura.usuario_creacion }}</small></p>
            </div>
            <div class="col-md-6 text-end">
                <h5>Receptor</h5>
                <p><strong>{{ factura.cliente_nombre or factura.cliente_rut }}</strong></p>
                <p class="mb-0">RUT: {{ factura.cliente_rut }}</p>
                <p class="mb-0">Dirección: {{ factura.cliente_direccion }}</p>
            </div>
        </div>

        <div class="row mb-2">
            <div class="col-md-3"><strong>Fecha Emisión:</strong> {{ factura.fecha_emision }}</div>
            <div class="col-md-3"><strong>Fecha Vencimiento:</strong> {{ factura.fecha_vencimiento or 'N/A' }}</div>
            <div class="col-md-3"><strong>Forma Pago:</strong> {{ factura.forma_pago or 'N/A' }}</div>
            <div class="col-md-3"><strong>Proyecto:</strong> {{ factura.proyecto_nombre or 'N/A' }}</div>
        </div>

        <hr>

        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Cod</th>
                        <th>Descripción</th>
                        <th class="text-end">Cantidad</th>
                        <th class="text-end">Precio Unit.</th>
                        <th class="text-end">% Desc</th>
                        <th class="text-end">Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for it in items %}
                    <tr>
                        <td>{{ it.codigo_producto or '' }}</td>
                        <td>{{ it.descripcion }}</td>
                        <td class="text-end">{{ it.cantidad }}</td>
                        <td class="text-end">{{ it.precio_unitario }}</td>
                        <td class="text-end">{{ it.descuento }}</td>
                        <td class="text-end">{{ it.total_linea }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="row justify-content-end mt-3">
            <div class="col-md-4">
                <div class="card p-3">
                    <div class="d-flex justify-content-between">
                        <div>Subtotal</div>
                        <div><strong>${{ factura.valor_neto }}</strong></div>
                    </div>
                    <div class="d-flex justify-content-between">
                        <div>IVA</div>
                        <div><strong>${{ factura.iva }}</strong></div>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between fs-5">
                        <div>Total</div>
                        <div><strong>${{ factura.valor_total }}</strong></div>
                    </div>
                </div>
            </div>
        </div>

        {% if referencia %}
        <div class="mt-4 alert alert-light">
            <strong>Documento de referencia:</strong> {{ referencia.tipo_doc }} #{{ referencia.numero_doc }} — ${{ referencia.valor_total }}
        </div>
        {% endif %}

    </div>
</div>
{% endblock %}
